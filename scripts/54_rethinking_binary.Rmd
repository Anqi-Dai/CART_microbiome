---
title: "the rethinking way of doing the binary outcome modeling"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rethinking)
library(tidyverse)  
```

```{r}
meta <- read_csv('../data/amplicon/stool/combined_2_meta.csv') %>% 
  mutate(logdiv_s = scale(log(meta$simpson_reciprocal))) %>% 
  mutate(tox = if_else(toxicity == 'yes', 1, 0),
         cr100 = if_else(cr_d100 == 'yes', 1, 0),
         loca = if_else(center == 'M', 1, 2))
```

```{r}
# visualize the var distribution 
table(meta$cr_d100)  
table(meta$toxicity)
hist(meta$simpson_reciprocal)
hist(log(meta$simpson_reciprocal)) # I think I should use log transformed
table(meta$center)
```
```{r}
dat_list <- list(
    tox = meta$tox,
    cr100 = meta$cr100,
    location = meta$loca,
    logdivs = meta$logdiv_s
    )

mtox <- ulam(
    alist(
        tox ~ dbinom( 1 , p ) ,
        logit(p) <- b*logdivs + a[location] ,
        b ~ dnorm( 0 , 1),
        a[location] ~ dnorm( 0 , 0.5 )
    ) , data=dat_list , chains=4 , log_lik=TRUE )
```

