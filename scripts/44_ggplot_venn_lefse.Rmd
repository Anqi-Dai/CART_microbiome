---
title: "ggplot and the venn diagram for the lefse bars !"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

Create a function of ggplot viewing the lefse res files and also venn to see the overlap and whatnot of the different comparisons

```{r}
pres <- list.files('../data/shotgun_output/humann3/', pattern = 'lefse_ready_pcts.tsv.res$', full.names = T)

pres_all <- pres %>% 
  set_names(pres) %>% 
  map_dfr(~ read_tsv(., col_names = c('pathway','xx','direction','score','pval')) %>% 
        filter(!is.na(score)), .id = 'pres') %>% 
  mutate(pres = str_replace(pres, '^.+//',''),
         pres = str_replace(pres, '_lefse.+$',''))  %>% 
  rename(grp = pres) %>% 
  mutate(grp = str_replace(grp, 'pull_','pull\\.')) %>% 
  separate(grp, into = c('cohort','outcome'), sep = '\\.')

pres_all_list <- pres_all %>% 
  split(., list(.$cohort, .$outcome )) %>% 
  map(~ pull(.data = ., pathway)) %>% 
  compact()

vars <- pres_all %>% 
  distinct(outcome) %>% 
  pull(outcome)

pres_all_list_every <- vars %>% 
  set_names(vars) %>% 
  map(function(var){
    pres_all_list %>% 
        keep(.p = str_detect(names(.), var))
  } )
```

```{r}
library(ggvenn)

pres_all_list_every %>% 
  imap(~ ggvenn(.x) +
         #labs(title = str_glue('{.y}')) +
          ggsave(str_glue('../figs/venn_pathway_{.y}.pdf'), width = 7, height = 4))
```

